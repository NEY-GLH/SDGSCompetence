{% extends "base2.html" %}
{% block content %}



    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                All Competencies
                <small></small>
            </h1>
            <ol class="breadcrumb">
                <li><a href="#"><i class="fa fa-dashboard"></i> Level</a></li>
                <li class="active">Here</li>
            </ol>
            {% if message %}
                <div class="alert alert-danger">
                    <strong>Fail Whale!</strong> {{ message }}
                </div>
            {% endif %}
        </section>

        <!-- Main content -->
        <section class="content container-fluid">
            <div class="nav-tabs-custom">
                <ul class="nav nav-tabs">
                    <li class="active"><a href="#tab_1" data-toggle="tab">Current Competencies</a></li>
                    <li><a href="#tab_2" data-toggle="tab">Previous Versions</a></li>
                    <li><a href="#tab_3" data-toggle="tab">In Progress</a></li>
                    <li class="pull-right">{% include "with_selected.html" %}</li>

                </ul>
                <div class="tab-content">
                    <div class="tab-pane active" id="tab_1">
                        <table class="table table-striped table-condensed competencies dataTable dt-responsive"
                               width="100%"
                               id="competencies">


                            <thead>
                            <th>id</th>
                            <th>version</th>
                            <th>Category</th>
                            <th>Title</th>
                            <th>Creator</th>
                            <th>Authorised By</th>
                            <th>Version</th>
                            <th>Status</th>
                            </thead>
                            {% for competence in current_data %}
                                <tr>
                                    <td>{{ competence.c_id }}</td>
                                    <td>{{ competence.intro }}</td>
                                    <td>{{ competence.category_rel.category }}</td>
                                    <td>{{ competence.title }}</td>
                                    <td>{{ competence.creator_rel.first_name }} {{ competence.creator_rel.last_name }}</td>
                                    <td>{{ competence.approve_rel.first_name }} {{ competence.approve_rel.last_name }}</td>
                                    <td>
                                        <small class="label bg-gray">v{{ competence.intro }}</small>
                                    </td>
                                    <td>
                                        {% if competence.competence.obsolete %}
                                            <p class="label label-danger">Inactive</p>
                                        {% else %}
                                            <p class="label label-success">Active</p>
                                        {% endif %}


                                    </td>
                                </tr>
                            {% endfor %}


                        </table>
                    </div>
                    <!-- /.tab-pane -->
                    <div class="tab-pane" id="tab_2">
                        <table class="table table-striped table-condensed competencies dataTable dt-responsive"
                               width="100%"
                               id="competencies_previous">


                            <thead>
                            <th>id</th>
                            <th>version</th>
                            <th>Category</th>
                            <th>Title</th>
                            <th>Creator</th>
                            <th>Authorised By</th>
                            <th>Version</th>
                            <th>Status</th>
                            </thead>
                            {% for competence in previous_data %}
                                <tr>
                                    <td>{{ competence.c_id }}</td>
                                    <td>{{ competence.intro }}</td>
                                    <td>{{ competence.category_rel.category }}</td>
                                    <td>{{ competence.title }}</td>
                                    <td>{{ competence.creator_rel.first_name }} {{ competence.creator_rel.last_name }}</td>
                                    <td>{{ competence.approve_rel.first_name }} {{ competence.approve_rel.last_name }}</td>
                                    <td>
                                        <small class="label bg-gray">v{{ competence.intro }}</small>
                                    </td>
                                    <td>
                                        {% if competence.competence.obsolete %}
                                            <p class="label label-danger">Inactive</p>
                                        {% else %}
                                            <p class="label label-success">Active</p>
                                        {% endif %}


                                    </td>
                                </tr>
                            {% endfor %}


                        </table>
                    </div>
                    <div class="tab-pane active" id="tab_3">
                    </div>

                </div>
                <!-- /.tab-content -->
            </div>


        </section>
    </div>

    <script>
        $('#with').text("With 0 Selected....");
        $('#actions').attr('disabled', 'disabled');
        $('#actions').attr('data-toggle', '');

        var competencies = $('.competencies').DataTable({
            "pageLength": 25,
            "columnDefs": [
                {
                    "targets": [0, 1],
                    "visible": false,
                    "searchable": false
                }],
            select: true
        })


        $("#actions").click(function () {
            var count = competencies.rows({selected: true}).count();
            console.log(count)
            if (count > 1) {
                console.log("hello")
                $('.single').hide()
            } else {
                $('.single').show()
            }
        });
        $("tr").click(function () {
            setTimeout(function () {
                var count_new = competencies.rows({selected: true}).count();
                $('#with').html("With " + count_new + " Selected....")
                if (count_new == 0) {
                    $('#actions').attr('disabled', 'disabled');
                    $('#actions').attr('data-toggle', '');
                } else {
                    $('#actions').removeAttr('disabled');
                    $('#actions').attr('data-toggle', 'dropdown');
                }
            }, 1)

        });
    </script>

{% endblock %}}