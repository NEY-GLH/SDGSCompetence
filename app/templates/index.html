{% extends "base2.html" %}
{% block content %}
    <section>
        <h1>
            <i class="fa fa-dashboard"></i> Dashboard
            <small>All your training information in one place.</small>
        </h1>
    </section>

        <!-- Main content -->
        <section class="content container-fluid">
            {% if message %}
                <div class="alert alert-danger">
                    <strong>Oooops!</strong> {{ message }}
                </div>
            {% endif %}

            {% if signoff or signoff_competence or signoff_reassessment|length > 0 %}
                <h2 class="page-header"><i class="fa fa-pencil"></i> To Approve</h2>

                {#            {% if signoff|length !=0 %}#}
                {% if signoff %}
                    <div class="box" id="training">
                        <div class="box-header with-border">
                            <h3 class="box-title">Submitted Evidence</h3>
                        </div>
                        <div class="box-body table-responsive">
                            <div class="row">
                                <div class="col-lg-12">


                                    This section provides a list of evidence that you need to sign-off.

                                    <table class="table table-striped">
                                        <thead>
                                        <th class="col-md-5">Competence/Sub Section(s) Covered</th>
                                        <th class="col-md-2">Evidence Type</th>
                                        <th class="col-md-1">Trainee</th>
                                        <th class="col-md-1">Trainer</th>
                                        <th class="col-md-1">Date Trained</th>
                                        <th class="col-md-2">Actions</th>
                                        </thead>

                                        {% for evidence in signoff %}
                                            <tr>
                                                <td>
                                                    <strong>{{ evidence.assessments[0].assess_id_rel.ss_id_rel.c_id_rel.competence_detail[-1].title }}:</strong>
                                                    <ul>
                                                        {% if evidence.assessments|length < 4  %}
                                                            {% for i in evidence.assessments %}
                                                                <li>{{ i.assess_id_rel.ss_id_rel.name }}</li>
                                                            {% endfor %}
                                                        {% else %}
                                                        <div id="header{{ evidence.id }}">
                                                            <li>This evidence covers {{ evidence.assessments|length }} subsections
                                                                <a href="javascript:void(0)" onclick="showSubsections('{{ evidence.id }}')"> [Show]</a>
                                                            </li>

                                                        </div>
                                                        <div id="subsections{{ evidence.id }}" hidden="hidden">
                                                            <a href="javascript:void(0)" onclick="hideSubsections('{{ evidence.id }}')"> [Hide]</a>
                                                            {% for i in evidence.assessments %}
                                                                <li style="font-size:12px">{{ i.assess_id_rel.ss_id_rel.name }}</li>
                                                            {% endfor %}
                                                        </div>
                                                        {% endif %}
                                                    </ul>

                                                </td>
                                                <td>
                                                    {{ evidence.evidence_type_rel.type}}
                                                </td>
                                                <td>
                                                    {{ evidence.assessments[0].assess_id_rel.user_id_rel.first_name }} {{ evidence.assessments[0].assess_id_rel.user_id_rel.last_name }}
                                                </td>
                                            <td>
                                                    {{ evidence.assessments[0].assess_id_rel.trainer_id_rel.first_name }} {{ evidence.assessments[0].assess_id_rel.trainer_id_rel.last_name }}
                                                </td>
                                                <td>
                                                    {% if evidence.assessments[0].assess_id_rel.date_of_training  %}
                                                    {{ evidence.assessments[0].assess_id_rel.date_of_training.strftime('%d-%m-%Y') }}
                                                    {% else %}
                                                        -
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    {% include "evidence.html" %}
                                                    {% include "accept_modal.html" %}
                                                    {% include "reject_modal.html" %}
                                                    <div class="btn-group">
                                                        <a data-toggle="modal" data="" href="#{{ evidence.id }}"
                                                           class="btn btn-sm btn-flat btn-primary"><span
                                                                class="glyphicon glyphicon-eye-open"></span></a>


                                                        <a data-toggle="modal" data="" href="#accept_{{ evidence.id }}"
                                                           class="btn btn-sm btn-flat btn-success"><span
                                                                class="glyphicon glyphicon-thumbs-up"></span></a>

                                                        <a data-toggle="modal" data="" href="#reject_{{ evidence.id }}"
                                                           class="btn btn-sm btn-flat btn-danger"><span
                                                                class="glyphicon glyphicon-thumbs-down"></span></a>
                                                    </div>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}

                {% if signoff_reassessment|length > 0 %}
                    <div class="box" id="training">
                        <div class="box-header with-border">
                            <h3 class="box-title"><i class="fa  fa-refresh"></i> Reassessments Sign-Off</h3>
                        </div>
                        <div class="box-body table-responsive">
                            <div class="row">
                                <div class="col-lg-12">
                                    <table class="table table-striped">
                                        <thead>
                                        <th class="col-md-2">Competence</th>
                                        <th class="col-md-3">Date Completed</th>
                                        <th class="col-md-2">Trainee</th>
                                        <th class="col-md-1">Version</th>
                                        <th class="col-md-2">Actions</th>
                                        </thead>

                                        {% for reassessment in signoff_reassessment %}
                                            <tr>
                                                {#                                            HERE YOU NEED TO GET THE RIGHT VERSION - I THINK THAT'S WHY THERE ARE TWO#}
                                                <td>
                                                    {% set current_version = reassessment.assessments_rel[0].assess_rel.ss_id_rel.c_id_rel.current_version %}
                                                    {% for competence in reassessment.assessments_rel[0].assess_rel.ss_id_rel.c_id_rel.competence_detail %}

                                                        {% if competence.intro <= current_version %}
                                                            {% if competence.last == None or competence.last >= current_version %}
                                                                {{ competence.title }}
                                                            {% endif %}

                                                        {% endif %}
                                                    {% endfor %}


                                                </td>
                                                <td>{{ reassessment.date_completed }}</td>
                                                <td>{{ reassessment.assessments_rel[0].assess_rel.user_id_rel.first_name }} {{ reassessment.assessments_rel[0].assess_rel.user_id_rel.last_name }}</td>
                                                <td>{{ reassessment.assessments_rel[0].assess_rel.version }}</td>
                                                <td>
                                                    <a href="{{ url_for('training.reassessment_view',reassess_id=reassessment.id) }}"
                                                       class="btn btn-sm btn-flat btn-primary"><span
                                                            class="glyphicon glyphicon-eye-open"></span> </a></td>
                                            </tr>

                                        {% endfor %}
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}



                {% if signoff_competence %}
                    <div class="box" id="training">
                        <div class="box-header with-border">
                            <h3 class="box-title">New/Edited Competencies</h3>
                        </div>
                        <div class="box-body table-responsive">
                            <div class="row">
                                <div class="col-lg-12">
                                    <table class="table table-striped">
                                        <thead>
                                        <th class="col-md-2">Category</th>
                                        <th class="col-md-3">Title</th>
                                        <th class="col-md-2">Author</th>
                                        <th class="col-md-2">Date Created</th>
                                        <th class="col-md-1">Version</th>
                                        <th class="col-md-2">Actions</th>
                                        </thead>

                                        {% for competence in signoff_competence %}
                                            <tr>
                                                <td>{{ competence.category_rel.category }}</td>
                                                <td>{{ competence.title }}</td>
                                                <td>{{ competence.creator_rel.first_name }} {{ competence.creator_rel.last_name }}</td>
                                                <td>{{ competence.date_created.strftime('%d-%m-%Y') }}</td>
                                                <td>
                                                    <small class="label bg-gray">v{{ competence.intro }}</small>
                                                </td>
                                                <td>
                                                    <div class="btn-group" style="display: flex">
                                                        <a href="{{ url_for('competence.view_competence') }}?c_id={{ competence.c_id }}&version={{ competence.intro }}"
                                                           class="btn btn-sm btn-flat btn-primary"><span
                                                                class="glyphicon glyphicon-eye-open"></span> </a>
                                                        <a href="{{ url_for('competence.approve',id=competence.c_id,version=competence.intro,u_id=current_user.database_id) }}"
                                                           class="btn btn-sm btn-flat btn-success"><span
                                                                class="glyphicon glyphicon-thumbs-up"></span> </a>


                                                        <button
                                                                class="btn btn-sm btn-flat btn-danger reject_button"
                                                                data-button='{"id":{{ competence.c_id }}}'><span
                                                                class="glyphicon glyphicon-thumbs-down"></span></button>


                                                        <div class="modal modal-default reject_comment"
                                                             id="reject_comment_{{ competence.c_id }}"
                                                             style="display: none;">
                                                            <div class="modal-dialog">

                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <h4 class="modal-title"><i
                                                                                class="fa fa-exclamation-triangle text-red"></i>Competence
                                                                            Rejection: {{ competence.title }}</h4>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        <form class="form-horizontal" id="feedback_form"
                                                                              action="{{ url_for('competence.reject',id=competence.c_id,version=competence.intro,u_id=current_user.database_id) }}"
                                                                              enctype="multipart/form-data"
                                                                              method="POST">


                                                                            <div class="form-group">
                                                                                <label class="col-lg-3 control-label">Enter
                                                                                    Feedback</label>
                                                                                <div class="col-lg-9"><textarea
                                                                                        name="feedback" id="feedback"
                                                                                        class="form-control"></textarea>
                                                                                </div>
                                                                            </div>
                                                                            <input type="submit"
                                                                                   class="btn btn-flat btn-danger"
                                                                                   value="Reject Competence">
                                                                            </input>


                                                                        </form>


                                                                    </div>
                                                                    <div class="modal-footer">

                                                                        <button type="button"
                                                                                class="btn btn-default btn-flat pull-right close_confirm">
                                                                            Close
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                                <!-- /.modal-content -->

                                                            </div>
                                                            <!-- /.modal-dialog -->
                                                        </div>

                                                    </div>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </table>

                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}

            {% endif %}






            <div class="row">
                <div class="col-md-12">
                    <div class="small-box box-solid bg-gray" id="training">
                        <div class="box-body text-center">

                            <form id="quick_competence" class="form-inline">

                                <div class="input-group col-md-7">
                                    <input type="text" name="name" id="name" class="form-control"
                                           placeholder="Quickly assign yourself some training here...  Just start typing the name of a competence.">
                                </div>

                                <div class="input-group date col-md-2">
                                    <div class="input-group-addon">
                                        <i class="fa fa-calendar"></i>
                                    </div>


                                    <input type="text" required="required" class="form-control pull-right"
                                           id="datepicker" name="due_date" data-date-format="dd/mm/yyyy"
                                           placeholder="Due Date">

                                </div>
                                <div class="input-group col-md-1">

                                    <input type="submit" class="btn btn-primary btn-flat"
                                           id="go"
                                           type="button" value="Assign To Me">

                                </div>
                            </form>
                            <span class="text-red" id="name_text"></span>
                            </div>


                    </div>
                </div>
            </div>

        <h2 class="page-header"><i class="fa fa-graduation-cap"></i> Assigned & In Progress Training</h2>

            <div class="row">
                <div class="col-lg-12">

                    <div class="box" id="training">
                        <div class="box-body table-responsive">


                            {% if assigned|length == 0 %}
                                You have no assigned or active training.
                            {% else %}
                                <table class="table table-striped">
                                    <thead>

                                    <th class="col-md-1">Category</th>
                                    <th class="col-md-3">Competence</th>
                                    <th class="col-md-1">Version</th>
                                    <th class="col-md-2">Assigned By</th>
                                    <th class="col-md-1">Date Assigned</th>
                                    <th class="col-md-1">Date Due</th>
                                    <th class="col-md-2">Action Required By</th>
                                    <th class="col-md-1">Progress</th>
                                    <th class="col-md-2">Actions</th>
                                    </thead>
                                    {% for assessment in assigned %}

                                        <tr>
                                            <td>{{ assessment.category }}</td>
                                            <td>{{ assessment.title }}
                                                {% if assessment.is_reassessment_max %}
                                                    <label class="label label-info">4yr</label>
                                                {% endif %}
                                            </td>
                                            <td>
                                                <small class="label bg-gray">v{{ assessment.version }}</small>
                                            </td>
                                            <td>{{ assessment.user }}</td>
                                            <td>{{ assessment.assigned.strftime('%d-%m-%Y') }}</td>
                                            <td>{{ check_due_date(assessment.assigned,assessment.due_date)|safe }}</td>
                                            <td>{{ get_next_actioner(assessment.c_id,current_user.database_id,assessment.version) }}</td>
                                            <td>

                                                <div class="progress progress-sm">
                                                    <div class="progress-bar progress-sm progress-bar-success progress-bar-striped"
                                                         role="progressbar" aria-valuenow="60"
                                                         aria-valuemin="0"
                                                         aria-valuemax="100"
                                                         style="width: {{ get_percent(assessment.c_id,current_user.database_id,assessment.version) }}%;">
                                                        <span class="sr-only">60% Complete</span>
                                                    </div>
                                                </div>


                                            </td>
                                            <td>
                                                <div class="btn-group" style="display: flex">
                                                    {% if count_active(assessment.c_id,current_user.database_id) != 100 %}
                                                        <a data-toggle="tooltip" title="Activate"
                                                           href="{{ url_for('training.select_subsections') }}?u_id={{ current_user.database_id }}&version={{ assessment.version }}&c_id={{ assessment.c_id }}&action=activate"
                                                           class="btn btn-sm btn-flat btn-success"><span
                                                                class="glyphicon glyphicon-play"></span>
                                                        </a>
                                                    {% else %}
                                                        <a data-toggle="tooltip" title="All Active"
                                                           class="btn btn-sm btn-flat btn-success" disabled>
                                                            <span class="glyphicon glyphicon-play"></span></a>

                                                    {% endif %}

                                                    <a data-toggle="tooltip" title="View"
                                                       href="{{ url_for('training.view_current_competence') }}?c_id={{ assessment.c_id }}&version={{ assessment.version }}"
                                                       class="btn btn-sm btn-flat btn-primary"><span
                                                            class="glyphicon glyphicon-eye-open"></span>


                                                    </a>

                                                    <button data-toggle="tooltip" title="Abandon"
                                                            version="{{ assessment.version }}"
                                                            c_id="{{ assessment.c_id }}"
                                                            class="btn btn-sm btn-warning btn-flat abandon_training"><i
                                                            class="fa fa-user-times"></i></button>

                                                </div>
                                            </td>
                                        </tr>

                                    {% endfor %}

                                </table>
                            {% endif %}
                        </div>
                    </div>
                </div>

            </div>

            <h2 class="page-header"><i class="fa fa-thumbs-o-up"></i> Complete Training</h2>
            <div class="row">
                <div class="col-lg-12">
                    <div class="nav-tabs-custom">
                        <ul class="nav nav-tabs">
                            <li class="active"><a href="#tab_1_complete" data-toggle="tab" aria-expanded="true">Complete
                                <span class="badge bg-gray">{{ complete|length }}</span>
                            </a></li>
                            <li class=""><a href="#tab_2_complete" data-toggle="tab" aria-expanded="false">Obsolete
                                <span class="badge bg-gray">{{ obsolete|length }}</span></a></li>
                        </ul>

                        <div class="tab-content table-responsive">
                            <div class="tab-pane active" id="tab_1_complete">

                                {% if complete|length > 0 %}
                                    <table class="table table-striped">
                                        <thead>
                                        <th class="col-md-1">Category</th>
                                        <th class="col-md-2">Competence</th>
                                        <th class="col-md-1">Version</th>
                                        <th class="col-md-2">In-date / Expired</th>
                                        <th class="col-md-2">Date Complete</th>
                                        <th class="col-md-2">Earliest Date of Expiry</th>
                                        <th class="col-md-2">Training Status</th>
                                        <th class="col-md-2">Actions</th>
                                        </thead>
                                        {% for i in complete %}
                                            <tr>
                                                <td>{{ i.category }}</td>
                                                <td>{{ i.title }}</td>
                                                <td>
                                                    <small class="label bg-gray">v{{ i.version }}</small>
                                                </td>
                                                {% if i != None %}
                                                    <td>{{ check_expiry(i.expiry, i.four_year_expiry)|safe }}</td>
                                                {% endif %}

                                                <td>
                                                    {% if i.completed != None %}
                                                        {{ i.completed.strftime('%d-%m-%Y') }}
                                                    {% endif %}
                                                </td>
                                                <td>   {% if i.expiry != None %}
                                                    {{ i.expiry.strftime('%d-%m-%Y') }}
                                                {% endif %}</td>
                                                <td>
                                                    {{ get_status(i.max_status)|safe }}
                                                </td>
                                                <td>
                                                    <div class="btn-group" style="display: flex">
                                                        <a href="{{ url_for('training.view_current_competence') }}?c_id={{ i.c_id }}&version={{ i.version }}"
                                                           class="btn btn-sm btn-primary btn-flat "><span
                                                                class="glyphicon glyphicon-eye-open"></span></a>
                                                        <a data-toggle="tooltip" title="Delete"
                                                           class="btn btn-sm btn-flat btn-danger remove_training"
                                                           id="{{ i.c_id }}" version="{{ i.version }}"><i
                                                                class="fa fa-remove"></i>
                                                        </a>
                                                    </div>

                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </table>
                                {% else %}
                                    You have no complete training.
                                {% endif %}

                            </div>
                            <div class="tab-pane" id="tab_2_complete">

                                {% if obsolete|length > 0 %}
                                    <table class="table table-striped">
                                        <thead>
                                        <th class="col-md-1">Category</th>
                                        <th class="col-md-2">Competence</th>
                                        <th class="col-md-1">Version</th>
                                        <th class="col-md-2">Date Complete</th>
                                        </thead>
                                        {% for i in obsolete %}
                                            <tr>
                                                <td>{{ i.ss_id_rel.c_id_rel.competence_detail[0].category_rel.category }}</td>
                                                <td>{{ i.ss_id_rel.c_id_rel.competence_detail[0].title }}</td>
                                                <td>
                                                    <small class="label bg-gray">v{{ i.version }}</small>
                                                </td>
                                                <td>
                                                    {{ i.date_completed }}
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </table>
                                {% else %}
                                    You have no obsolete training.
                                {% endif %}

                            </div>


                        </div>
                    </div>
                </div>
            </div>


            <h2 class="page-header"><i class="fa fa-edit"></i> My Competencies</h2>


            <div class="nav-tabs-custom">
                <ul class="nav nav-tabs">
                    <li class="active"><a href="#tab_1" data-toggle="tab">In Progress
                        <span class="badge bg-gray">{{ competences_incomplete|length }}</span>
                    </a></li>
                    <li><a href="#tab_2" data-toggle="tab">Complete <span
                            class="badge bg-gray">{{ competences_complete|length }}</span></a></li>
                    <li class="pull-right"><a href="{{ url_for('competence.add_competence') }}" class="text-muted"><i
                            class="fa fa-plus"></i> Add Competence</a></li>

                </ul>

                <div class="tab-content table-responsive">
                    <div class="tab-pane active" id="tab_1">
                        {% if competences_incomplete|length != 0 %}
                            <table class="table table-striped table-condensed competencies dataTable dt-responsive"
                                   width="100%"
                                   id="my_competencies_incomplete">


                                <thead>
                                <th class="col-md-1">Category</th>
                                <th class="col-md-3">Competence</th>
                                <th class="col-md-2">Date Created</th>
                                <th class="col-md-2">Authoriser</th>
                                {#                                <th>Q-Pulse Doc Number</th>#}
                                <th class="col-md-2">Approval Status</th>
                                <th class="col-md-2">Actions</th>

                                </thead>
                                {% for i in competences_incomplete %}
                                    <tr>
                                        <td>{{ i.category_rel.category }}</td>
                                        <td>{{ i.title }}</td>
                                        <td>{{ i.date_created.strftime('%d-%m-%Y') }}
                                        </td>
                                        <td>{{ i.approve_rel.first_name }} {{ i.approve_rel.last_name }}</td>
                                        {#                                        <td>{{ i.qpulsenum }}</td>#}
                                        <td>{{ get_approval_status(i.approved)|safe }}

                                            {% if i.rejection_rel|length > 0 and i.approved == None %}
                                                <span class="label label-danger">Feedback Available</span>
                                            {% endif %}


                                        </td>
                                        <td>
                                            <div class="btn-group" style="display: flex">
                                                <a data-toggle="tooltip" title="View"
                                                   href="{{ url_for('competence.view_competence') }}?c_id={{ i.c_id }}&version={{ i.intro }}"
                                                   class="btn btn-sm btn-flat btn-primary"><span
                                                        class="glyphicon glyphicon-eye-open"></span></a>



                                                {% if i.approved != None %}
                                                    <button data-toggle="tooltip" title="Edit"
                                                            class="btn btn-sm btn-flat btn-success" disabled>
                                                        <icon class="fa fa-edit"></icon>
                                                    </button>
                                                {% else %}

                                                    <a data-toggle="tooltip" title="Edit"
                                                       href="{{ url_for('competence.edit_competence') }}?ids={{ i.c_id }}"
                                                       class="btn btn-sm btn-flat btn-success">
                                                        <icon class="fa fa-edit"></icon>
                                                    </a>
                                                {% endif %}


                                                <button data-toggle="tooltip" title="Send for approval"
                                                        href=""
                                                        class="btn btn-sm btn-flat btn-warning approval"
                                                        id="approval_{{ i.id }}"
                                                        {% if i.approved != None %}
                                                        disabled
                                                        {% endif %}
                                                ><span
                                                        class="glyphicon glyphicon-thumbs-up"></span>
                                                </button>


                                                <a data-toggle="tooltip" title="Delete"
                                                   class="btn btn-sm btn-flat btn-danger remove_competence"
                                                   id="{{ i.id }}"><i
                                                        class="fa fa-remove"></i>
                                                </a>
                                            </div>
                                        </td>


                                    </tr>
                                {% endfor %}

                            </table>
                        {% else %}
                            You have no competencies in progress.
                        {% endif %}

                    </div>
                    <div class="tab-pane" id="tab_2">

                        <table class="table table-striped table-condensed competencies dataTable dt-responsive"
                               id="my_competencies_complete">
                            <thead>
                            <th>Category</th>
                            <th>Competence</th>
                            <th>Date Created</th>
                            <th>Date Expiry</th>
                            <th>Authoriser</th>
                            <th>Actions</th>
                            </thead>
                            {% for i in competences_complete %}
                                <tr>
                                    <td>{{ i.category_rel.category }}</td>
                                    <td>{{ i.title }}</td>
                                    <td>{{ i.date_created.strftime('%d-%m-%Y') }}</td>
                                    <td>
                                        {% if i.date_expiry %}
                                            {{ i.date_expiry.strftime('%d-%m-%Y') }}
                                        {% endif %}

                                        {% if i.expired == 1 %}
                                            <span class="glyphicon glyphicon-alert" style="color: red"></span>
                                        {% endif %}
                                    </td>
                                    <td>{{ i.approve_rel.first_name }} {{ i.approve_rel.last_name }}</td>
                                    <td>
                                        <div class="btn-group" style="display: flex">
                                            <a data-toggle="tooltip" title="View"
                                               href="{{ url_for('competence.view_competence') }}?c_id={{ i.c_id }}&version={{ i.intro }}"
                                               class="btn btn-sm btn-flat btn-primary"><span
                                                    class="glyphicon glyphicon-eye-open"></span></a>


                                            <a data-toggle="tooltip" title="Edit"
                                               href="{{ url_for('competence.edit_competence') }}?ids={{ i.c_id }}"
                                               class="btn btn-sm btn-flat btn-success">
                                                <icon
                                                        class="fa fa-edit"></icon>
                                            </a>

<!--                                            <a data-toggle="tooltip" title="Delete"-->
<!--                                            class="btn btn-sm btn-flat btn-danger remove_competence"-->
<!--                                            id="{{ i.c_id }}"><i class="fa fa-remove"></i>-->
<!--                                             </a>-->
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}

                        </table>
                        <br>
                        <small>* Please note, if your competence has transferred ownership or has been edited by
                            another user it will no longer display here.
                        </small>

                    </div>

                </div>
            </div>




            {% if "LINEMANAGER" in current_user.roles %}

                <h2 class="page-header"><i class="fa fa-users"></i> My Team</h2>
                <div class="row">
                    <div class="col-md-12">
                        <div class="box box-solid bg-gray-light" id="training">
                         <div class="box-header">
                            <h3 class="box-title text-black"><i class="fa fa-link"></i> Quick Links</h3>
                        </div>
                            <div class="box-body">
                                {% for report in linereports %}

                                    <div class="btn-group">
                                      <button type="button" class="btn btn-default dropdown-toggle pad_bottom" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i
                                            class="fa fa-user"></i> {{ report.first_name }} {{ report.last_name }} <span class="caret"></span>
                                      </button>
                                      <ul class="dropdown-menu">
                                        <li><a href="{{ url_for('competence.assign_user_to_competence') }}?ids={{ report.id }}">Assign a Competence</a></li>
                                          <li role="separator" class="divider"></li>
                                          <li><a href="{{ url_for('training.user_report',id=report.id) }}">View User Report</a></li>

                                      </ul>
                                    </div>




                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                <div class="col-md-6">
                    <div class="box box-solid bg-gray-light" id="training">
                        <div class="box-header">
                            <h3 class="box-title text-black"><i class="fa fa-bar-chart"></i> Competence Status
                                Summary</h3>
                        </div>
                        <div class="box-body">


                            <div class="chart">
                                <canvas id="barChart" style="height: 300px; width: 497px;" width="621"
                                        height="300"></canvas>
                            </div>
                            <small>* This is a count of total assessments and not total competencies.</small><br>
                            <small>† This includes expired/expiring competencies.</small>
                        </div>
                    </div>

                </div>
                <div class="col-md-6 fill">
                    <div class="box box-danger" id="training">
                        <div class="box-header">
                            <h3 class="box-title"><i class="fa fa-calendar-times-o"></i> Expiring/Expired
                                Competencies</h3>
                        </div>
                        <div class="box-body">
                            <table class="table table-condensed">
                                <thead>
                                <th>User</th>
                                <th>Expiring</th>
                                <th>Expired</th>
                                </thead>

                                {% for report in linereports %}
                                    {% if "expiring" in counts[report.id] or "expired" in counts[report.id] %}
                                    <tr>
                                        <td>{{ report.first_name }} {{ report.last_name }}</td>
                                        <td>
                                            {% if "expiring" in counts[report.id] %}
                                                {{ counts[report.id]["expiring"] }}
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if "expired" in counts[report.id] %}
                                                {{ counts[report.id]["expired"] }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endif %}
                                {% endfor %}


                                </table>

                        <small>* This is a count of total assessments and not total competencies.</small>

                        </div>

                    </div>
                </div>
                </div>
                <div class="row">
                    <div class="col-md-12">


                        <div class="box collapsed-box" id="training">
                            <div class="box-header with-border">
                                <h3 class="box-title">Detailed Counts</h3>
                                <div class="pull-right box-tools">

                <button type="button" class="btn btn-default btn-flat btn-sm pull-right" data-widget="collapse" data-toggle="tooltip" title="" style="margin-right: 5px;" data-original-title="Collapse">
                  <i class="fa fa-plus"></i></button>
              </div>

                            </div>
                            <div class="box-body table-responsive table-striped table-condensed">

                                <table class="table table-responsive table-striped table-condensed table-hover no-padding">
                                    <thead>
                                    <th class="col-md-2">Name</th>
                                    <th class="col-md-1">Assigned</th>
                                    <th class="col-md-1">Active</th>
                                    <th class="col-md-1">Sign-Off</th>
                                    <th class="col-md-1">Complete †</th>
                                    <th class="col-md-1">Failed</th>
                                    <th class="col-md-1">Abandoned</th>
                                    <th class="col-md-1">Obsolete</th>
                                    <th class="col-md-1">Expiring</th>
                                    <th class="col-md-1">Expired</th>
                                    <th class="col-md-1">Not Required</th>
                                    </thead>
                                    {% for report in linereports %}
                                        <tr>
                                            <td>{{ report.first_name }} {{ report.last_name }}</td>
                                            <td>{{ counts[report.id]["assigned"] }}</td>
                                            <td>{{ counts[report.id]["active"] }}</td>
                                            <td>{{ counts[report.id]["sign-off"] }}</td>
                                            <td>{{ counts[report.id]["complete"] }}</td>
                                            <td>{{ counts[report.id]["failed"] }}</td>
                                            <td>{{ counts[report.id]["abandoned"] }}</td>
                                            <td>{{ counts[report.id]["obsolete"] }}</td>
                                            <td>{% if "expiring" in counts[report.id] %}{{ counts[report.id]["expiring"] }}{% else %}0{% endif %}</td>
                                            <td>{% if "expired" in counts[report.id] %}{{ counts[report.id]["expired"] }}{% else %}0{% endif %}</td>
                                            <td>{{ counts[report.id]["not_required"] }}</td>

                                        </tr>
                                    {% endfor %}
                                </table>

                                {% if linereports_inactive > 0 %}
                                    <br>
                                    <div class="callout callout-default">
                                        <p>You have {{ linereports_inactive }} inactive line reports. Click here to
                                            view.</p>
                                    </div>
                                {% endif %}

                                <small>* This is a count of total assessments and not total competencies.</small><br>
                            <small>† This includes expired/expiring competencies.</small>

                            </div>
                        </div>


                    </div>

                </div>


            {% endif %}

        </section>
    </div>

    <div class="modal modal-default" id="make_obsolete" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title"><i class="fa fa-exclamation-triangle text-red"></i> Are you sure you want to
                        make this training obsolete?</h4>
                </div>
                <div class="modal-body">
                    This will not delete the data, but will set it to obsolete status
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger btn-flat pull-left" id="confirmed">Yes Make Obsolete
                    </button>
                    <button type="button" class="btn btn-default btn-flat pull-right close_confirm">Close
                    </button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <div class="modal modal-default" id="remove_confirm" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title"><i class="fa fa-exclamation-triangle text-red"></i> Are you sure you want to
                        delete?</h4>
                </div>
                <div class="modal-body">
                    This will <b>permanently</b> remove this item! All data will be lost!
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger btn-flat pull-left" id="delete_confirmed">Yes Delete
                    </button>
                    <button type="button" class="btn btn-default btn-flat pull-right close_confirm">Close
                    </button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>

    <div class="modal modal-default" id="abandon_confirm" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title"><i class="fa fa-exclamation-triangle text-orange"></i> Are you sure you want
                        to
                        abandon this training?</h4>
                </div>
                <div class="modal-body">
                    This will set the training to abandoned!
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-warning btn-flat pull-left" id="abandon_confirmed">Yes Abandon
                    </button>
                    <button type="button" class="btn btn-default btn-flat pull-right close_confirm">Close
                    </button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>


    <script src="/static/bower_components/chart.js/Chart.js"></script>

    <script>
        function showSubsections(id){
            console.log("showing subsections");
            console.log(id);
            var subsections = document.getElementById('subsections'+id);
            var header = document.getElementById('header'+id);
            subsections.removeAttribute('hidden');
            header.setAttribute('hidden', 'hidden');
        }

        function hideSubsections(id){
            console.log("hiding subsections");
            console.log(id);
            var subsections = document.getElementById('subsections'+id);
            var header = document.getElementById('header'+id);
            header.removeAttribute('hidden');
            subsections.setAttribute('hidden', 'hidden');
        }

        // $('#showbutton').click(function () {
        //     console.log("showing subsections");
        //     var subsections = document.getElementById('showsubsections');
        //     var header = document.getElementById('hidesubsections');
        //     subsections.removeAttribute('hidden');
        //     header.setAttribute('hidden', 'hidden');
        //
        // });
        //
        // $('#hidebutton').click(function () {
        //     console.log("hiding subsections");
        //     var subsections = document.getElementById('showsubsections');
        //     var header = document.getElementById('hidesubsections');
        //     header.removeAttribute('hidden');
        //     subsections.setAttribute('hidden', 'hidden');
        //
        // });

        $(document).ready(function () {

            //Date picker
            $('#datepicker').datepicker({
                autoclose: true,
                format: 'dd/mm/yyyy',
                startDate: '+1d'

            })


        });

        $(document).ready(function () {

            {# function to remove competence that is not complete #}

            $('.approval').click(function () {
                id = $(this).attr('id')
                console.log(id)
                $.ajax({
                    url: '{{ url_for("competence.send_for_approval") }}?id=' + id.replace('approval_', ''),
                    success: function (response) {
                        location.reload();
                    },
                });
            });

            var id;
            var url;
            var version;
            $('.abandon_training').click(function () {
                id = $(this).attr('c_id');
                version = $(this).attr('version');
                console.log(id);
                $('#abandon_confirm').show();
                url = '{{ url_for("training.abandon") }}?c_id=' + id + '&version=' + version;
                console.log(url);

            });

            $('#abandon_confirmed').click(function () {
                $.ajax({
                    type: 'post',
                    url: url,
                    success: function (response) {
                        location.reload();
                    },
                });
            });

            $('.close_confirm').click(function () {


                $(this).parent().parent().parent().parent().hide();

            });


            $('.remove_competence').click(function () {
                var compdetails_id = $(this).attr('id');
                console.log(compdetails_id);
                $('#remove_confirm').show();
                url = '{{ url_for("competence.delete") }}?id=' + compdetails_id

            });

            $('.remove_training').click(function () {
                id = $(this).attr('id');
                version = $(this).attr('version');
                console.log("hello");
                console.log(id);
                console.log(version);
                $('#make_obsolete').show();
                url = '{{ url_for("training.delete") }}?c_id=' + id + '&version='+version

            });


            $('.reject_button').click(function () {
                id = $(this).attr('id')
                var data = $.parseJSON($(this).attr('data-button'));
                console.log(id)
                console.log("hello")
                $('#reject_comment_' + data["id"]).show();

            });


            $('#confirmed').click(function () {
                $.ajax({
                    type: 'post',
                    url: url,
                    success: function (response) {
                        location.reload();
                    },
                });
            });

            $('#delete_confirmed').click(function () {
                $.ajax({
                    type: 'post',
                    url: url,
                    success: function (response) {
                        location.reload();
                    }
                });
            });

            $('#close_confirm').click(function () {
                $('#remove_confirm').hide();
            });


            $(function () {
                $('#name').click(function () {
                    $(this).val("");
                    $('#name_group').removeClass("has-error");
                    $('#name_text').text('');

                });
            });


            $(function () {

                $('#quick_competence').on('submit', function (e) {

                    e.preventDefault();


                    $.ajax({
                        type: 'post',
                        data: $('#quick_competence').serialize(), url: '{{ url_for("competence.check_exists") }}',
                        success: function (response) {


                            $.ajax({
                                type: 'post',
                                data: $('#quick_competence').serialize(),
                                url: '{{ url_for("competence.assign_user_to_competence") }}?ids={{ current_user.database_id }}',
                                success: function (response) {
                                    location.reload();
                                },

                            });

                        },
                        error: function (error) {
                            $('#name_group').addClass("has-error");
                            $('#name_text').text('Hey! Competence Not Found!');
                        },
                    });
                });
            });


            $(function () {
                $.ajax({
                    url: '{{ url_for("competence.competence_name_autocomplete") }}'
                }).done(function (data) {
                    $('#name').autocomplete({
                        source: data.json_list,
                        minLength: 2

                    });
                });
            });


            {#            var note_count = parseInt({{ notes[0] }});#}
            {#            if ( note_count > 0) {#}
            {#                console.log(note_count)#}
            {#                $('#notifications_modal').modal('show');#}
            {#            };#}
            {##}


            var complete = $('#my_competencies_complete').DataTable({
                "pageLength": 10,
                "columnDefs": [
                    {
                        {#                        "targets": [0],#}
                        "visible": false,
                        "searchable": false
                    }],
                select: false
            });
            var incomplete = $('#my_competencies_incomplete').DataTable({
                "pageLength": 10,
                "columnDefs": [
                    {
                        {#                        "targets": [0],#}
                        "visible": false,
                        "searchable": false
                    }],
                select: false
            })
        })
        ;
        $(function () {
            /* ChartJS
             * -------
             * Here we will create a few charts using ChartJS
             */

            var data = {
                labels: ['Assigned', 'Active', 'Sign-Off', 'Complete †', 'Failed', 'Abandoned', 'Obselete', 'Expiring', 'Expired', 'Not Required'],
                datasets: [{
                    data: [{{ assigned_count }}, {{ active_count }}, {{ signoff_count }}, {{ complete_count }}, {{ failed_count }}, {{ abandoned_count }}, 0, {{ expiring_count }}, {{ expired_count }}, {{ not_required_count }}],
                    label: 'Digital Goods',
                    fillColor: '#EA5D4E',
                    strokeColor: 'rgba(60,141,188,0.8)',
                    pointColor: '#3b8bba',
                    pointStrokeColor: 'rgba(60,141,188,1)',
                    pointHighlightFill: '#fff',
                    pointHighlightStroke: 'rgba(60,141,188,1)',
                }]
            }
            //-------------
            //- BAR CHART -
            //-------------
            var barChartCanvas = $('#barChart').get(0).getContext('2d')
            var barChart = new Chart(barChartCanvas)
            var barChartData = data
            barChartData.datasets[0].fillColor = '#EA5D4E'
            barChartData.datasets[0].strokeColor = '#8c8c8c'
            barChartData.datasets[0].pointColor = '#ffcc00'
            var barChartOptions = {
                //Boolean - Whether the scale should start at zero, or an order of magnitude down from the lowest value
                scaleBeginAtZero: true,
                //Boolean - Whether grid lines are shown across the chart
                scaleShowGridLines: true,
                //String - Colour of the grid lines
                scaleGridLineColor: 'rgba(0,0,0,.05)',
                //Number - Width of the grid lines
                scaleGridLineWidth: 0,
                //Boolean - Whether to show horizontal lines (except X axis)
                scaleShowHorizontalLines: true,
                //Boolean - Whether to show vertical lines (except Y axis)
                scaleShowVerticalLines: true,
                //Boolean - If there is a stroke on each bar
                barShowStroke: true,
                //Number - Pixel width of the bar stroke
                barStrokeWidth: 1,
                //Number - Spacing between each of the X value sets
                barValueSpacing: 5,
                //Number - Spacing between data sets within X values
                barDatasetSpacing: 1,
                //String - A legend template
                {#      legendTemplate          : '<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>',#}
                //Boolean - whether to make the chart responsive
                responsive: true,
                maintainAspectRatio: true
            };

            barChartOptions.datasetFill = false
            barChart.Bar(barChartData, barChartOptions)
        })
    </script>

{% endblock %}