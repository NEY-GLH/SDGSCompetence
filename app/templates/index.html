{% extends "base2.html" %}
{% block content %}



    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                <i class="fa fa-dashboard"></i> Dashboard
                <small>All your training information in one place.</small>
            </h1>
            {#            <ol class="breadcrumb">#}
            {#                <li><a href="#"><i class="fa fa-dashboard"></i> Level</a></li>#}
            {#                <li class="active">Here</li>#}
            {#            </ol>#}
            {% if message %}
                <div class="alert alert-danger">
                    <strong>Fail Whale!</strong> {{ message }}
                </div>
            {% endif %}
        </section>

        <!-- Main content -->
        <section class="content container-fluid">


            {% if signoff or signoff_competence %}
                <h2 class="page-header"><i class="fa fa-pencil"></i> To Approve</h2>

                {#            {% if signoff|length !=0 %}#}
                {% if signoff %}
                    <div class="box" id="training">
                        <div class="box-header with-border">
                            <h3 class="box-title">Submitted Evidence</h3>
                        </div>
                        <div class="box-body table-responsive">
                            <div class="row">
                                <div class="col-lg-12">


                                    This section provides a list of evidence that you need to sign-off.
                                    {{ evidence }}
                                    <table class="table table-striped">
                                        <thead>
                                        <th class="col-md-6">Competence/Sub Section(s) Covered</th>
                                        <th class="col-md-2">Trainee</th>
                                        <th class="col-md-2">Date Trained</th>
                                        <th  lass="col-md-2">Actions</th>
                                        </thead>

                                        {% for evidence in signoff %}
                                            <tr>
                                                <td>
                                                    <strong>{{ evidence.assessments[0].assess_id_rel.ss_id_rel.c_id_rel.competence_detail[0].title }}:</strong>
                                                    <ul>
                                                        {% for i in evidence.assessments %}
                                                            <li>{{ i.assess_id_rel.ss_id_rel.name }}</li>
                                                        {% endfor %}
                                                    </ul>

                                                </td>
                                                <td>
                                                    {{ evidence.assessments[0].assess_id_rel.user_id_rel.first_name }} {{ evidence.assessments[0].assess_id_rel.user_id_rel.last_name }}
                                                </td>
                                                <td>
                                                    {{ evidence.assessments[0].assess_id_rel.date_of_training.strftime('%d-%m-%Y') }}
                                                </td>
                                                <td>
                                                    {% include "evidence.html" %}
                                                    {% include "accept_modal.html" %}
                                                    {% include "reject_modal.html" %}
                                                    <div class="btn-group">
                                                        <a data-toggle="modal" data="" href="#{{ evidence.id }}"
                                                           class="btn btn-sm btn-flat btn-primary"><span
                                                                class="glyphicon glyphicon-eye-open"></span></a>


                                                        <a data-toggle="modal" data="" href="#accept_{{ evidence.id }}"
                                                           class="btn btn-sm btn-flat btn-success"><span
                                                                class="glyphicon glyphicon-thumbs-up"></span></a>

                                                        <a data-toggle="modal" data="" href="#reject_{{ evidence.id }}"
                                                           class="btn btn-sm btn-flat btn-danger"><span
                                                                class="glyphicon glyphicon-thumbs-down"></span></a>
                                                    </div>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
                {% if signoff_competence %}
                    <div class="box" id="training">
                        <div class="box-header with-border">
                            <h3 class="box-title">New/Edited Competencies</h3>
                        </div>
                        <div class="box-body table-responsive">
                            <div class="row">
                                <div class="col-lg-12">
                                    <table class="table table-striped">
                                        <thead>
                                        <th class="col-md-2">Category</th>
                                        <th class="col-md-3">Title</th>
                                        <th class="col-md-2">Author</th>
                                        <th class="col-md-2">Date Created</th>
                                        <th class="col-md-1">Version</th>
                                        <th class="col-md-2">Actions</th>
                                        </thead>

                                        {% for competence in signoff_competence %}
                                            <tr>
                                                <td>{{ competence.category_rel.category }}</td>
                                                <td>{{ competence.title }}</td>
                                                <td>{{ competence.creator_rel.first_name }} {{ competence.creator_rel.last_name }}</td>
                                                <td>{{ competence.date_created.strftime('%d-%m-%Y') }}</td>
                                                <td>
                                                    <small class="label bg-gray">v{{ competence.intro }}</small>
                                                </td>
                                                <td>
                                                    <div class="btn-group" style="display: flex">
                                                        <a href="{{ url_for('competence.view_competence') }}?c_id={{ competence.c_id }}&version={{ competence.intro }}"
                                                           class="btn btn-sm btn-flat btn-primary"><span
                                                                class="glyphicon glyphicon-eye-open"></span> </a>
                                                        <a href="{{ url_for('competence.approve',id=competence.c_id,version=competence.intro,u_id=current_user.database_id) }}"
                                                           class="btn btn-sm btn-flat btn-success"><span
                                                                class="glyphicon glyphicon-thumbs-up"></span> </a>

                                                        <a data-toggle="modal" data=""
                                                           href="#reject_{{ competence.id }}"
                                                           class="btn btn-sm btn-flat btn-danger"><span
                                                                class="glyphicon glyphicon-thumbs-down"></span>
                                                        </a>
                                                    </div>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </table>

                                </div>
                            </div>
                        </div>
                    </div>
                {% else %}
                    You have no competencies to approve.
                {% endif %}

            {% endif %}




            <h2 class="page-header"><i class="fa fa-graduation-cap"></i>My Training</h2>

            <div class="row">
                <div class="col-lg-12">
                    <div class="small-box bg-gray" id="training">
                        <form id="quick_competence">
                            <div class="box-body">
                                <div class="input-group" id="name_group">


                                    <input type="text" name="name" id="name" class="form-control"
                                           placeholder="Quickly assign yourself some training here...  Just start typing the name of a competence.">

                             <span class="input-group-btn"><input type="submit" class="btn btn-primary btn-flat"
                                                                  id="go"
                                                                  type="button" value="Assign To Me"></span>

                                </div>
                                <span class="text-red" id="name_text"></span>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-12">

                    <div class="box" id="training">
                        <div class="box-header with-border">
                            <h3 class="box-title">Assigned & In Progress Training</h3>
                            <div class="box-tools pull-right">
                                <small class="label pull-right bg-black">{{ assigned|length }}</small>
                            </div>
                        </div>
                        <div class="box-body table-responsive">


                            {% if assigned|length == 0 %}
                                You have no assigned or active training.
                            {% else %}
                                <table class="table table-striped">
                                    <thead>

                                    <th class="col-md-1">Category</th>
                                    <th class="col-md-2">Competence</th>
                                    <th class="col-md-1">Version</th>
                                    <th class="col-md-1">Status</th>
                                    <th class="col-md-2">Assigned By</th>
                                    <th class="col-md-2">Date Assigned</th>
                                    <th class="col-md-1">Progress</th>
                                    <th class="col-md-2">Actions</th>
                                    </thead>
                                    {% for assessment in assigned %}


                                        <tr>
                                            <td>{{ assessment.category }}</td>
                                            <td>{{ assessment.title }}</td>
                                            <td>
                                                <small class="label bg-gray">v{{ assessment.version }}</small>
                                            </td>
                                            <td>

                                            </td>
                                            <td>{{ assessment.user }}</td>
                                            <td>{{ assessment.assigned.strftime('%d-%m-%Y') }}</td>
                                            <td>

                                                <div class="progress progress-sm">
                                                    <div class="progress-bar progress-sm progress-bar-success progress-bar-striped"
                                                         role="progressbar" aria-valuenow="60"
                                                         aria-valuemin="0"
                                                         aria-valuemax="100"
                                                         style="width: {{ get_percent(assessment.c_id,current_user.database_id,assessment.version) }}%;">
                                                        <span class="sr-only">60% Complete</span>
                                                    </div>
                                                </div>


                                            </td>
                                            <td>
                                                <div class="btn-group" style="display: flex">
                                                    {% if count_active(assessment.c_id,current_user.database_id) != 100 %}
                                                        <a data-toggle="tooltip" title="Activate"
                                                           href="{{ url_for('training.select_subsections') }}?u_id={{ current_user.database_id }}&version={{ assessment.version }}&c_id={{ assessment.c_id }}&action=activate"
                                                           class="btn btn-sm btn-flat btn-success"><span
                                                                class="glyphicon glyphicon-play"></span>
                                                        </a>
                                                    {% else %}
                                                        <a data-toggle="tooltip" title="All Active"
                                                           class="btn btn-sm btn-flat btn-success" disabled>
                                                            <span class="glyphicon glyphicon-play"></span></a>

                                                    {% endif %}

                                                    <a data-toggle="tooltip" title="View"
                                                       href="{{ url_for('training.view_current_competence') }}?c_id={{ assessment.c_id }}&version={{ assessment.version }}"
                                                       class="btn btn-sm btn-flat btn-primary"><span
                                                            class="glyphicon glyphicon-eye-open"></span>


                                                    </a>

                                                    <button data-toggle="tooltip" title="Abandon"
                                                            version="{{ assessment.version }}"
                                                            c_id="{{ assessment.c_id }}"
                                                            class="btn btn-sm btn-warning btn-flat abandon_training"><i
                                                            class="fa fa-user-times"></i></button>

                                                </div>
                                            </td>
                                        </tr>

                                    {% endfor %}

                                    {#                                    {% for assessment in assigned %}#}
                                    {##}
                                    {#                                        {% for details in assessment.ss_id_rel.c_id_rel.competence_detail %}#}
                                    {#                                            <tr>#}
                                    {#                                                <td>{{ details.title }}</td>#}
                                    {#                                                <td><small class="label bg-gray">v{{ details.intro }}</small></td>#}
                                    {#                                                <td>#}
                                    {##}
                                    {#                                                </td>#}
                                    {#                                                <td>{{ assessment.assign_id_rel.first_name }} {{ assessment.assign_id_rel.last_name }}</td>#}
                                    {#                                                <td>{{ assessment.date_assigned }}</td>#}
                                    {#                                                <td>#}
                                    {##}
                                    {#                                                    <div class="progress">#}
                                    {#                                                        <div class="progress-bar progress-bar-success progress-bar-striped"#}
                                    {#                                                             role="progressbar" aria-valuenow="60"#}
                                    {#                                                             aria-valuemin="0"#}
                                    {#                                                             aria-valuemax="100"#}
                                    {#                                                             style="width: {{ get_percent(details.c_id,current_user.database_id) }}%;">#}
                                    {#                                                            <span class="sr-only">60% Complete</span>#}
                                    {#                                                        </div>#}
                                    {#                                                    </div>#}
                                    {##}
                                    {##}
                                    {#                                                </td>#}
                                    {#                                                <td>#}
                                    {#                                                    {% if count_active(details.c_id,current_user.database_id) != 100 %}#}
                                    {#                                                        <a href="{{ url_for('training.select_subsections') }}?u_id={{ current_user.database_id }}&c_id={{ details.c_id }}&action=activate"#}
                                    {#                                                           class="btn btn-xs btn-flat btn-primary"><span#}
                                    {#                                                                class="glyphicon glyphicon-play"></span>#}
                                    {#                                                            Activate</a>#}
                                    {#                                                    {% else %}#}
                                    {#                                                        <a#}
                                    {#                                                                class="btn btn-xs btn-flat btn-primary" disabled><span#}
                                    {#                                                                class="glyphicon glyphicon-remove"></span>#}
                                    {#                                                            All Active</a>#}
                                    {##}
                                    {#                                                    {% endif %}#}
                                    {##}
                                    {#                                                </td>#}
                                    {##}
                                    {##}
                                    {#                                                <td>#}
                                    {#                                                    <a href="{{ url_for('training.view_current_competence') }}?c_id={{ details.c_id }}"#}
                                    {#                                                       class="btn btn-xs btn-flat btn-primary"><span#}
                                    {#                                                            class="glyphicon glyphicon-eye-open"></span>#}
                                    {#                                                        View</a></td>#}
                                    {#                                            </tr>#}
                                    {#                                        {% endfor %}#}
                                    {#                                    {% endfor %}#}
                                </table>
                            {% endif %}
                        </div>
                    </div>
                </div>

            </div>
            <div class="row">
                <div class="col-lg-12">


                    <div class="box" id="training">
                        <div class="box-header with-border">
                            <h3 class="box-title">Complete Training</h3>
                            <div class="box-tools pull-right">
                                <small class="label pull-right bg-black">{{ complete|length }}</small>
                            </div>
                        </div>

                        <div class="box-body table-responsive">
                            {% if complete|length > 0 %}
                                <table class="table table-striped">
                                    <thead>
                                    <th class="col-md-1">Category</th>
                                    <th class="col-md-2">Competence</th>
                                    <th class="col-md-1">Version</th>
                                    <th class="col-md-2">Some Sub-Sections...</th>
                                    <th class="col-md-2">Date Complete</th>
                                    <th class="col-md-2">Earliest Date of Expiry</th>
                                    <th class="col-md-2">Actions</th>
                                    </thead>
                                    {% for i in complete %}
                                        <tr>
                                            <td>{{ i.category }}</td>
                                            <td>{{ i.title }}</td>
                                            <td>
                                                <small class="label bg-gray">v{{ i.version }}</small>
                                            </td>
                                            {% if i != None %}
                                                <td>{{ check_expiry(i.expiry)|safe }}</td>
                                            {% endif %}

                                            <td>
                                                {% if i.completed != None %}
                                                    {{ i.completed.strftime('%d-%m-%Y') }}
                                                {% endif %}
                                            </td>
                                            <td>   {% if i.expiry != None %}
                                                {{ i.expiry.strftime('%d-%m-%Y') }}
                                            {% endif %}</td>
                                            <td>
                                                <div class="btn-group" style="display: flex">
                                                    <a href="{{ url_for('training.view_current_competence') }}?c_id={{ i.c_id }}&version={{ i.version }}"
                                                       class="btn btn-sm btn-primary btn-flat "><span
                                                            class="glyphicon glyphicon-eye-open"></span></a>

                                                    <a data-toggle="modal" data=""
                                                       href="{{ url_for('training.select_subsections') }}?c_id={{ i.c_id }}&version={{ i.version }}&action=reassess"
                                                       class="btn btn-sm btn-success btn-flat"><span
                                                            class="glyphicon glyphicon-repeat"></span></a>

                                                    <a data-toggle="tooltip" title="Delete"
                                                       class="btn btn-sm btn-flat btn-danger remove_training"
                                                       id="{{ i.id }}"><i
                                                            class="fa fa-remove"></i>
                                                    </a>
                                                </div>

                                            </td>
                                        </tr>
                                    {% endfor %}
                                </table>
                            {% else %}
                                You have no complete training.
                            {% endif %}

                        </div>
                    </div>
                </div>
            </div>


            <h2 class="page-header"><i class="fa fa-edit"></i> My Competencies</h2>


            <div class="nav-tabs-custom">
                <ul class="nav nav-tabs">
                    <li class="active"><a href="#tab_1" data-toggle="tab">In Progress
                        <span class="badge bg-gray">{{ competences_incomplete|length }}</span>
                    </a></li>
                    <li><a href="#tab_2" data-toggle="tab">Complete <span
                            class="badge bg-gray">{{ competences_complete|length }}</span></a></li>
                    <li class="pull-right"><a href="{{ url_for('competence.add_competence') }}" class="text-muted"><i
                            class="fa fa-plus"></i> Add Competence</a></li>

                </ul>

                <div class="tab-content table-responsive">
                    <div class="tab-pane active" id="tab_1">
                        {% if competences_incomplete|length != 0 %}
                            <table class="table table-striped table-condensed competencies dataTable dt-responsive"
                                   width="100%"
                                   id="my_competencies_incomplete">


                                <thead>
                                <th class="col-md-1">Category</th>
                                <th class="col-md-3">Competence</th>
                                <th class="col-md-2">Date Created</th>
                                <th class="col-md-2">Authoriser</th>
                                {#                                <th>Q-Pulse Doc Number</th>#}
                                <th class="col-md-2">Approval Status</th>
                                <th class="col-md-2">Actions</th>

                                </thead>
                                {% for i in competences_incomplete %}
                                    <tr>
                                        <td>{{ i.category_rel.category }}</td>
                                        <td>{{ i.title }}</td>
                                        <td>{{ i.date_created.strftime('%d-%m-%Y') }}</td>
                                        <td>{{ i.approve_rel.first_name }} {{ i.approve_rel.last_name }}</td>
                                        {#                                        <td>{{ i.qpulsenum }}</td>#}
                                        <td>{{ get_approval_status(i.approved)|safe }}</td>
                                        <td>
                                            <div class="btn-group" style="display: flex">
                                                <a data-toggle="tooltip" title="View"
                                                   href="{{ url_for('competence.view_competence') }}?c_id={{ i.c_id }}&version={{ i.intro }}"
                                                   class="btn btn-sm btn-flat btn-primary"><span
                                                        class="glyphicon glyphicon-eye-open"></span></a>



                                                {% if i.approved != None %}
                                                    <button data-toggle="tooltip" title="Edit"
                                                            class="btn btn-sm btn-flat btn-success" disabled>
                                                        <icon class="fa fa-edit"></icon>
                                                    </button>
                                                {% else %}

                                                    <a data-toggle="tooltip" title="Edit"
                                                       href="{{ url_for('competence.edit_competence') }}?ids={{ i.c_id }}"
                                                       class="btn btn-sm btn-flat btn-success">
                                                        <icon class="fa fa-edit"></icon>
                                                    </a>
                                                {% endif %}


                                                <button data-toggle="tooltip" title="Send for approval"
                                                        href=""
                                                        class="btn btn-sm btn-flat btn-warning approval"
                                                        id="approval_{{ i.id }}"
                                                        {% if i.approved != None %}
                                                        disabled
                                                        {% endif %}
                                                ><span
                                                        class="glyphicon glyphicon-thumbs-up"></span>
                                                </button>


                                                <a data-toggle="tooltip" title="Delete"
                                                   class="btn btn-sm btn-flat btn-danger remove_competence"
                                                   id="{{ i.id }}"><i
                                                        class="fa fa-remove"></i>
                                                </a>
                                            </div>
                                        </td>


                                    </tr>
                                {% endfor %}

                            </table>
                        {% endif %}
                    </div>
                    <div class="tab-pane" id="tab_2">
                        <table class="table table-striped table-condensed competencies dataTable dt-responsive"
                               id="my_competencies_complete">
                            <thead>
                            <th>Category</th>
                            <th>Competence</th>
                            <th>Date Created</th>
                            <th>Authoriser</th>
                            <th>Actions</th>
                            </thead>
                            {% for i in competences_complete %}
                                <tr>
                                    <td>{{ i.category_rel.category }}</td>
                                    <td>{{ i.title }}</td>
                                    <td>{{ i.date_created.strftime('%d-%m-%Y') }}</td>
                                    <td>{{ i.approve_rel.first_name }} {{ i.approve_rel.last_name }}</td>
                                    <td>
                                        <div class="btn-group" style="display: flex">
                                            <a data-toggle="tooltip" title="View"
                                               href="{{ url_for('competence.view_competence') }}?c_id={{ i.c_id }}&version={{ i.intro }}"
                                               class="btn btn-sm btn-flat btn-primary"><span
                                                    class="glyphicon glyphicon-eye-open"></span></a>


                                            <a data-toggle="tooltip" title="Edit"
                                               href="{{ url_for('competence.edit_competence') }}?ids={{ i.c_id }}"
                                               class="btn btn-sm btn-flat btn-success">
                                                <icon
                                                        class="fa fa-edit"></icon>
                                            </a>

                                            {#                                                <a data-toggle="tooltip" title="Delete"#}
                                            {#                                                   class="btn btn-sm btn-flat btn-danger remove_competence"#}
                                            {#                                                   id="{{ i.id }}"><i#}
                                            {#                                                        class="fa fa-remove"></i>#}
                                            {#                                                </a>#}
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}

                        </table>
                    </div>
                </div>
            </div>




            {% if "LINEMANAGER" in current_user.roles %}

                <h2 class="page-header"><i class="fa fa-users"></i> My Team</h2>
                <div class="row">
                    <div class="col-md-5">
                        <div class="box" id="training">
                            <div class="box-header with-border">
                                <h3 class="box-title">Summary</h3>
                            </div>
                            <div class="box-body">


                                <div class="chart">
                                    <canvas id="barChart" style="height: 300px; width: 497px;" width="621"
                                            height="300"></canvas>
                                </div>

                            </div>
                        </div>

                    </div>
                    <div class="col-md-7">


                        <div class="box" id="training">
                            <div class="box-header with-border">
                                <h3 class="box-title">Details</h3>
                            </div>
                            <div class="box-body table-responsive ">
                                <table class="table table-hover no-padding">
                                    <thead>
                                    <th class="col-md-3">Name</th>
                                    <th class="col-md-1">Assigned</th>
                                    <th class="col-md-1">Active</th>
                                    <th class="col-md-1">Complete</th>
                                    <th class="col-md-1">Failed</th>
                                    <th class="col-md-2">Abandoned</th>
                                    <th class="col-md-1">Obsolete</th>
                                    <th class="col-md-1">Expiring</th>
                                    <th class="col-md-1">Expired</th>
                                    </thead>
                                    {% for report in linereports %}
                                        <tr>
                                            <td>{{ report.first_name }} {{ report.last_name }}</td>
                                            <td>{{ counts[report.id]["assigned"] }}</td>
                                            <td>{{ counts[report.id]["active"] }}</td>
                                            <td>{{ counts[report.id]["complete"] }}</td>
                                            <td>{{ counts[report.id]["failed"] }}</td>
                                            <td>{{ counts[report.id]["abandoned"] }}</td>
                                            <td>{{ counts[report.id]["obsolete"] }}</td>
                                            <td></td>
                                            <td></td>

                                        </tr>
                                    {% endfor %}
                                </table>

                                {% if linereports_inactive > 0 %}
                                    <div class="callout callout-default">
                                        <p>You have {{ linereports_inactive }} inactive line reports. Click here to
                                            view.</p>
                                    </div>
                                {% endif %}
                            </div>
                        </div>


                    </div>

                </div>


            {% endif %}

        </section>
    </div>


    {#    <div class="modal modal-danger fade ui-front" id="notifications_modal" style="display: none;">#}
    {#        <div class="modal-dialog">#}
    {#            <div class="modal-content">#}
    {#                <div class="modal-header">#}
    {#                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">#}
    {#                        <span aria-hidden="true">×</span></button>#}
    {#                    <h4 class="modal-title">You Have {{ notes[0] }} Notifications!</h4>#}
    {#                </div>#}
    {#                <div class="modal-body">#}
    {#                    Click here to see them!#}
    {#                </div>#}
    {#                <div class="modal-footer">#}
    {#                    <button type="button" class="btn btn-default btn-flat pull-right" data-dismiss="modal">Close#}
    {#                    </button>#}
    {#                </div>#}
    {#            </div>#}
    {#            <!-- /.modal-content -->#}
    {#        </div>#}
    {#        <!-- /.modal-dialog -->#}
    {#    </div>#}


    <div class="modal modal-default" id="remove_confirm" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title"><i class="fa fa-exclamation-triangle text-red"></i> Are you sure you want to
                        delete?</h4>
                </div>
                <div class="modal-body">
                    This will <b>permanently</b> remove this item! All data will be lost!
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger btn-flat pull-left" id="confirmed">Yes Delete
                    </button>
                    <button type="button" class="btn btn-default btn-flat pull-right" id="close_confirm">Close
                    </button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>

    <div class="modal modal-default" id="abandon_confirm" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title"><i class="fa fa-exclamation-triangle text-orange"></i> Are you sure you want
                        to
                        abandon this training?</h4>
                </div>
                <div class="modal-body">
                    This will set the training to abandoned!
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-warning btn-flat pull-left" id="abandon_confirmed">Yes Abandon
                    </button>
                    <button type="button" class="btn btn-default btn-flat pull-right" id="abandon_close_confirm">Close
                    </button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>


    <script src="/static/bower_components/chart.js/Chart.js"></script>

    <script>
        $(document).ready(function () {
            {# function to remove competence that is not complete #}

            $('.approval').click(function () {
                id = $(this).attr('id')
                console.log(id)
                $.ajax({
                    url: '{{ url_for("competence.send_for_approval") }}?id=' + id.replace('approval_', ''),
                    success: function (response) {
                        location.reload();
                    },
                });
            });

            var id;
            var url;
            var version;
            $('.abandon_training').click(function () {
                id = $(this).attr('c_id');
                version =  $(this).attr('version');
                console.log(id);
                $('#abandon_confirm').show();
                url = '{{ url_for("training.abandon") }}?c_id=' + id + '&version=' + version;
                console.log(url);

            });

            $('#abandon_confirmed').click(function () {
                $.ajax({
                    type: 'post',
                    url: url,
                    success: function (response) {
                        location.reload();
                    },
                });
            });

            $('#abandon_close_confirm').click(function () {
                $('#abandon_confirm').hide();
            });


            $('.remove_competence').click(function () {
                id = $(this).attr('id')
                console.log(id)
                $('#remove_confirm').show();
                url = '{{ url_for("competence.delete") }}?c_id=' + id

            });

            $('.remove_training').click(function () {
                id = $(this).attr('id')
                console.log(id)
                $('#remove_confirm').show();
                url = '{{ url_for("training.delete") }}?c_id=' + id

            });


            $('#confirmed').click(function () {
                $.ajax({
                    type: 'post',
                    url: url,
                    success: function (response) {
                        location.reload();
                    },
                });
            });

            $('#close_confirm').click(function () {
                $('#remove_confirm').hide();
            });


            $(function () {
                $('#name').click(function () {
                    $(this).val("");
                    $('#name_group').removeClass("has-error");
                    $('#name_text').text('');

                });
            });


            $(function () {

                $('#quick_competence').on('submit', function (e) {

                    e.preventDefault();


                    $.ajax({
                        type: 'post',
                        data: $('#quick_competence').serialize(), url: '{{ url_for("competence.check_exists") }}',
                        success: function (response) {


                            $.ajax({
                                type: 'post',
                                data: $('#quick_competence').serialize(),
                                url: '{{ url_for("competence.assign_user_to_competence") }}?ids={{ current_user.database_id }}',
                                success: function (response) {
                                    location.reload();
                                },

                            });

                        },
                        error: function (error) {
                            $('#name_group').addClass("has-error");
                            $('#name_text').text('Hey! Competence Not Found!');
                        },
                    });
                });
            });


            $(function () {
                $.ajax({
                    url: '{{ url_for("competence.competence_name_autocomplete") }}'
                }).done(function (data) {
                    $('#name').autocomplete({
                        source: data.json_list,
                        minLength: 2

                    });
                });
            });


            {#            var note_count = parseInt({{ notes[0] }});#}
            {#            if ( note_count > 0) {#}
            {#                console.log(note_count)#}
            {#                $('#notifications_modal').modal('show');#}
            {#            };#}
            {##}


            var complete = $('#my_competencies_complete').DataTable({
                "pageLength": 10,
                "columnDefs": [
                    {
                        {#                        "targets": [0],#}
                        "visible": false,
                        "searchable": false
                    }],
                select: false
            })
            var incomplete = $('#my_competencies_incomplete').DataTable({
                "pageLength": 10,
                "columnDefs": [
                    {
                        {#                        "targets": [0],#}
                        "visible": false,
                        "searchable": false
                    }],
                select: false
            })
        })
        ;
        $(function () {
            /* ChartJS
             * -------
             * Here we will create a few charts using ChartJS
             */

            var data = {
                labels: ['Assigned', 'Active', 'Complete', 'Failed', 'Abandoned', 'Obselete', 'Expiring', 'Expired'],
                datasets: [{
                    data: [{{ assigned_count }}, {{ active_count }}, {{ complete_count }}, 0, {{ abandoned_count }}, 0, 0, 0],
                    label: 'Digital Goods',
                    fillColor: 'rgba(60,141,188,0.9)',
                    strokeColor: 'rgba(60,141,188,0.8)',
                    pointColor: '#3b8bba',
                    pointStrokeColor: 'rgba(60,141,188,1)',
                    pointHighlightFill: '#fff',
                    pointHighlightStroke: 'rgba(60,141,188,1)',
                }]
            }
            //-------------
            //- BAR CHART -
            //-------------
            var barChartCanvas = $('#barChart').get(0).getContext('2d')
            var barChart = new Chart(barChartCanvas)
            var barChartData = data
            barChartData.datasets[0].fillColor = '#00a65a'
            barChartData.datasets[0].strokeColor = '#00a65a'
            barChartData.datasets[0].pointColor = '#00a65a'
            var barChartOptions = {
                //Boolean - Whether the scale should start at zero, or an order of magnitude down from the lowest value
                scaleBeginAtZero: true,
                //Boolean - Whether grid lines are shown across the chart
                scaleShowGridLines: true,
                //String - Colour of the grid lines
                scaleGridLineColor: 'rgba(0,0,0,.05)',
                //Number - Width of the grid lines
                scaleGridLineWidth: 1,
                //Boolean - Whether to show horizontal lines (except X axis)
                scaleShowHorizontalLines: true,
                //Boolean - Whether to show vertical lines (except Y axis)
                scaleShowVerticalLines: true,
                //Boolean - If there is a stroke on each bar
                barShowStroke: true,
                //Number - Pixel width of the bar stroke
                barStrokeWidth: 2,
                //Number - Spacing between each of the X value sets
                barValueSpacing: 5,
                //Number - Spacing between data sets within X values
                barDatasetSpacing: 1,
                //String - A legend template
                {#      legendTemplate          : '<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>',#}
                //Boolean - whether to make the chart responsive
                responsive: true,
                maintainAspectRatio: true
            }

            barChartOptions.datasetFill = false
            barChart.Bar(barChartData, barChartOptions)
        })

    </script>

{% endblock %}