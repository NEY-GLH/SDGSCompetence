{% extends "base2.html" %}
{% block content %}



    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                Dashboard
                <small></small>
            </h1>
            <ol class="breadcrumb">
                <li><a href="#"><i class="fa fa-dashboard"></i> Level</a></li>
                <li class="active">Here</li>
            </ol>
            {% if message %}
                <div class="alert alert-danger">
                    <strong>Fail Whale!</strong> {{ message }}
                </div>
            {% endif %}
        </section>

        <!-- Main content -->
        <section class="content container-fluid">

            <h2 class="page-header">Training</h2>


            <div class="row">
                <div class="col-lg-12">

                    <div class="box" id="training">
                        <div class="box-header with-border">
                            <h3 class="box-title">Assigned & In Progress</h3>
                            <div class="box-tools pull-right">
                                <small class="label pull-right bg-black">{{ assigned|length }}</small>
                            </div>
                        </div>
                        <div class="box-body">


                            {% if assigned|length == 0 %}
                                You have no assigned or active training.
                            {% else %}
                                <table class="table table-striped">
                                    <thead>

                                    <th>Competence</th>
                                    <th>Status</th>
                                    <th>Assigned By</th>
                                    <th>Date Assigned</th>
                                    <th>Progress</th>
                                    <th>Activate Sub Competencies</th>
                                    <th>View & Update Training</th>
                                    </thead>


                                    {% for assessment in assigned %}

                                        {% for details in assessment.ss_id_rel.c_id_rel.competence_detail %}
                                            <tr>
                                                <td>{{ details.title }}</td>
                                                <td>

                                                </td>
                                                <td>{{ assessment.assign_id_rel.first_name }} {{ assessment.assign_id_rel.last_name }}</td>
                                                <td>{{ assessment.date_assigned }}</td>
                                                <td>

                                                    <div class="progress">
                                                        <div class="progress-bar progress-bar-success progress-bar-striped"
                                                             role="progressbar" aria-valuenow="60"
                                                             aria-valuemin="0"
                                                             aria-valuemax="100"
                                                             style="width: {{ get_percent(details.c_id,current_user.database_id) }}%;">
                                                            <span class="sr-only">60% Complete</span>
                                                        </div>
                                                    </div>


                                                </td>
                                                <td>
                                                    {% if count_active(details.c_id,current_user.database_id) != 100 %}
                                                        <a href="{{ url_for('training.select_subsections') }}?u_id={{ current_user.database_id }}&c_id={{ details.c_id }}&action=activate"
                                                           class="btn btn-xs btn-flat btn-primary"><span
                                                                class="glyphicon glyphicon-play"></span>
                                                            Activate</a>
                                                    {% else %}
                                                        <a
                                                                class="btn btn-xs btn-flat btn-primary" disabled><span
                                                                class="glyphicon glyphicon-remove"></span>
                                                            All Active</a>

                                                    {% endif %}

                                                </td>


                                                <td>
                                                    <a href="{{ url_for('training.view_current_competence') }}?c_id={{ details.c_id }}"
                                                       class="btn btn-xs btn-flat btn-primary"><span
                                                            class="glyphicon glyphicon-eye-open"></span>
                                                        View</a></td>
                                            </tr>
                                        {% endfor %}
                                    {% endfor %}
                                </table>
                            {% endif %}
                        </div>
                    </div>
                </div>

            </div>
            <div class="row">
                <div class="col-lg-12">


                    <div class="box" id="training">
                        <div class="box-header with-border">
                            <h3 class="box-title">Complete Competencies</h3>
                            <div class="box-tools pull-right">
                                <small class="label pull-right bg-black">{{ complete|length }}</small>
                            </div>
                        </div>
                        <div class="box-body table-responsive no-padding">

                            <table class="table table-striped">
                                <thead>

                                <th>Competence</th>
                                <th>Some Sub-Sections...</th>
                                <th>Date Complete</th>
                                <th>Earliest Date of Expiry</th>
                                <th>Actions</th>
                                </thead>
                                {% for i in complete %}
                                    <tr>
                                        <td>{{ i.title }}</td>
                                        <td>{{ check_expiry(i.expiry)|safe }}</td>
                                        <td>{{ i.completed }}</td>
                                        <td>{{ i.expiry }}</td>
                                        <td>
                                            <div class="btn-group">
                                                <a href="{{ url_for('training.view_current_competence') }}?c_id={{ i.c_id }}"
                                                   class="btn btn-sm btn-info btn-flat "><span
                                                        class="glyphicon glyphicon-eye-open"></span></a>


                                                <a data-toggle="modal" data="" href=""
                                                   class="btn btn-sm btn-success btn-flat"><span
                                                        class="glyphicon glyphicon-repeat"></span></a>

                                                <a data-toggle="modal" data="" href=""
                                                   class="btn btn-sm btn-danger btn-flat"><span
                                                        class="glyphicon glyphicon-trash"></span></a>

                                            </div>

                                        </td>
                                    </tr>
                                {% endfor %}
                            </table>

                        </div>
                    </div>
                </div>
            </div>


            <div class="box" id="training">
                <div class="box-header with-border">
                    <h3 class="box-title">Awaiting Sign-Off</h3>
                </div>
                <div class="box-body">
                    {#            {% if signoff|length !=0 %}#}
                    {% if signoff %}
                        <div class="row">
                            <div class="col-lg-12">


                                This section provides a list of evidence that you need to sign-off.
                                {{ evidence }}
                                <table class="table table-striped">
                                    <thead>
                                    <th>Competence/Sub Section(s) Covered</th>
                                    <th>Trainee</th>
                                    <th>Actions</th>
                                    </thead>

                                    {% for evidence in signoff %}
                                        <tr>
                                            <td>
                                                <strong>{{ evidence.assessments[0].assess_id_rel.ss_id_rel.c_id_rel.competence_detail[0].title }}:</strong>
                                                <ul>
                                                    {% for i in evidence.assessments %}
                                                        <li>{{ i.assess_id_rel.ss_id_rel.name }}</li>
                                                    {% endfor %}
                                                </ul>

                                            </td>
                                            <td>
                                                {{ evidence.assessments[0].assess_id_rel.user_id_rel.first_name }} {{ evidence.assessments[0].assess_id_rel.user_id_rel.last_name }}
                                            </td>
                                            <td>
                                                {% include "evidence.html" %}
                                                {% include "accept_modal.html" %}
                                                {% include "reject_modal.html" %}
                                                <div class="btn-group">
                                                    <a data-toggle="modal" data="" href="#{{ evidence.id }}"
                                                       class="btn btn-sm btn-flat btn-primary"><span
                                                            class="glyphicon glyphicon-eye-open"></span> View</a>


                                                    <a data-toggle="modal" data="" href="#accept_{{ evidence.id }}"
                                                       class="btn btn-sm btn-flat btn-success"><span
                                                            class="glyphicon glyphicon-thumbs-up"></span> Accept</a>

                                                    <a data-toggle="modal" data="" href="#reject_{{ evidence.id }}"
                                                       class="btn btn-sm btn-flat btn-danger"><span
                                                            class="glyphicon glyphicon-thumbs-down"></span> Reject</a>
                                                </div>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </table>
                            </div>
                        </div>
                    {% else %}
                        You have nothing to sign-off.
                    {% endif %}
                </div>
            </div>
            {% if "LINEMANAGER" in current_user.roles %}

                <h2 class="page-header">My Team</h2>
                <div class="row">
                    <div class="col-md-5">
                        <div class="box" id="training">
                            <div class="box-header with-border">
                                <h3 class="box-title">Summary</h3>
                            </div>
                            <div class="box-body">


                                <div class="chart">
                                    <canvas id="barChart" style="height: 300px; width: 497px;" width="621"
                                            height="300"></canvas>
                                </div>

                            </div>
                        </div>

                    </div>
                    <div class="col-md-7">


                        <div class="box" id="training">
                            <div class="box-header with-border">
                                <h3 class="box-title">Details</h3>
                            </div>
                            <div class="box-body table-responsive ">
                                <table class="table table-hover no-padding">
                                    <thead>
                                    <th class="col-md-3">Name</th>
                                    <th class="col-md-1">Assigned</th>
                                    <th class="col-md-1">Active</th>
                                    <th class="col-md-1">Complete</th>
                                    <th class="col-md-1">Failed</th>
                                    <th class="col-md-2">Abandoned</th>
                                    <th class="col-md-1">Obsolete</th>
                                    <th class="col-md-1">Expiring</th>
                                    <th class="col-md-1">Expired</th>
                                    </thead>
                                    {% for report in linereports %}
                                        <tr>
                                            <td>{{ report.first_name }} {{ report.last_name }}</td>
                                            <td>{{ counts[report.id]["assigned"] }}</td>
                                            <td>{{ counts[report.id]["active"] }}</td>
                                            <td>{{ counts[report.id]["complete"] }}</td>
                                            <td>{{ counts[report.id]["failed"] }}</td>
                                            <td>{{ counts[report.id]["abandoned"] }}</td>
                                            <td>{{ counts[report.id]["obsolete"] }}</td>
                                            <td></td>
                                            <td></td>

                                        </tr>
                                    {% endfor %}
                                </table>

                                {% if linereports_inactive > 0 %}
                                    <div class="callout callout-default">
                                        <p>You have {{ linereports_inactive }} inactive line reports. Click here to
                                            view.</p>
                                    </div>
                                {% endif %}
                            </div>
                        </div>


                    </div>

                </div>


            {% endif %}

            <h2 class="page-header">My Competencies</h2>


            <div class="row">
                <div class="col-lg-6">
                    <div class="box" id="training">
                        <div class="box-header with-border">
                            <h3 class="box-title">Incomplete</h3>
                            <div class="box-tools pull-right">
                                <small class="label pull-right bg-black">{{ competences_incomplete|length }}</small>
                            </div>
                        </div>
                        <div class="box-body table-responsive no-padding">
                            {% if competences_incomplete|length != 0 %}
                                <div class="row">
                                    <div class="col-lg-12">


                                        <table class="table table-striped">
                                            <thead>
                                            <th>Competence</th>
                                            <th>Category</th>
                                            <th>Q-Pulse Doc Number</th>
                                            <th>Continue Editing</th>
                                            <th>Mark Complete</th>
                                            </thead>
                                            {% for i in competences_incomplete %}
                                                <tr>
                                                    <td>{{ i.title }}</td>
                                                    <td>{{ i.category_rel.category }}</td>
                                                    <td>{{ i.qpulsenum }}</td>
                                                    <td><a href="" class="btn btn-sm btn-default"><span
                                                            class="glyphicon glyphicon-pencil"></span></a>
                                                    <td><a href="" class="btn btn-sm btn-default"><span
                                                            class="glyphicon glyphicon-ok"></span></a>
                                                </tr>
                                            {% endfor %}

                                        </table>

                                    </div>
                                </div>
                            {% endif %}


                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="box" id="training">
                        <div class="box-header with-border">
                            <h3 class="box-title">Complete</h3>
                            <div class="box-tools pull-right">
                                <small class="label pull-right bg-black">{{ competences_complete|length }}</small>
                            </div>
                        </div>
                        <div class="box-body table-responsive no-padding">
                            <div class="row">
                                <div class="col-lg-12">

                                    <table class="table table-striped">
                                        <thead>
                                        <th>Competence</th>
                                        <th>Category</th>
                                        <th>Q-Pulse Doc Number</th>
                                        </thead>
                                        {% for i in competences_complete %}
                                            <tr>
                                                <td>{{ i.title }}</td>
                                                <td>{{ i.category_rel.category }}</td>
                                                <td>{{ i.qpulsenum }}</td>

                                            </tr>
                                        {% endfor %}

                                    </table>

                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>
    </div>
    <script src="/static/bower_components/chart.js/Chart.js"></script>

    <script>


        $(function () {
            /* ChartJS
             * -------
             * Here we will create a few charts using ChartJS
             */

            var data = {
                labels: ['Assigned', 'Active', 'Complete', 'Failed', 'Abandoned', 'Obselete', 'Expiring', 'Expired'],
                datasets: [{
                    data: [{{ assigned_count }}, {{ active_count }}, {{ complete_count }}, 0, 0, 0, 0, 0],
                    label: 'Digital Goods',
                    fillColor: 'rgba(60,141,188,0.9)',
                    strokeColor: 'rgba(60,141,188,0.8)',
                    pointColor: '#3b8bba',
                    pointStrokeColor: 'rgba(60,141,188,1)',
                    pointHighlightFill: '#fff',
                    pointHighlightStroke: 'rgba(60,141,188,1)',
                }]
            }
            //-------------
            //- BAR CHART -
            //-------------
            var barChartCanvas = $('#barChart').get(0).getContext('2d')
            var barChart = new Chart(barChartCanvas)
            var barChartData = data
            barChartData.datasets[0].fillColor = '#00a65a'
            barChartData.datasets[0].strokeColor = '#00a65a'
            barChartData.datasets[0].pointColor = '#00a65a'
            var barChartOptions = {
                //Boolean - Whether the scale should start at zero, or an order of magnitude down from the lowest value
                scaleBeginAtZero: true,
                //Boolean - Whether grid lines are shown across the chart
                scaleShowGridLines: true,
                //String - Colour of the grid lines
                scaleGridLineColor: 'rgba(0,0,0,.05)',
                //Number - Width of the grid lines
                scaleGridLineWidth: 1,
                //Boolean - Whether to show horizontal lines (except X axis)
                scaleShowHorizontalLines: true,
                //Boolean - Whether to show vertical lines (except Y axis)
                scaleShowVerticalLines: true,
                //Boolean - If there is a stroke on each bar
                barShowStroke: true,
                //Number - Pixel width of the bar stroke
                barStrokeWidth: 2,
                //Number - Spacing between each of the X value sets
                barValueSpacing: 5,
                //Number - Spacing between data sets within X values
                barDatasetSpacing: 1,
                //String - A legend template
                {#      legendTemplate          : '<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>',#}
                //Boolean - whether to make the chart responsive
                responsive: true,
                maintainAspectRatio: true
            }

            barChartOptions.datasetFill = false
            barChart.Bar(barChartData, barChartOptions)
        })

    </script>

{% endblock %}